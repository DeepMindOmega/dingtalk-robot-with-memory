# 系统配置与账户经验

**Type**: long_term
**Source**: opencode_experience
**Created**: 2026-02-14T23:33:37.152705+00:00
**ID**: 100

**Tags**: opencode, api, config, security

---

## 概述
文档时间范围：2026-01-30 至 2026-02-15
主题：系统配置、账户管理、AI工具配置

### 成功1：Coding Plan账户配置
**账户信息**

**主套餐：GLM Coding Plan max包月**
- 文档：https://docs.bigmodel.cn/cn/coding-plan/overview
- API Key: `5f5ae7b36c07485d97baf63b560407d5`
- Base URL: `https://open.bigmodel.cn/api/coding/paas/v4`
- 用途：主Agent、顾问、写作

**副套餐：阿里百炼轻量包月**
- Base URL: `https://coding.dashscope.aliyuncs.com/v1`
- API Key: `sk-sp-608664d68e084f8595e19adf22c76e58`
- 用途：探索、开发任务（轻量）
- 最新模型：`qwen3-coder-plus`、`qwen3-max`

**其他套餐：Claude Code**
- Base URL: `https://ai-in.one/v1`
- API Key: `sk-302d672abd34ff780e30f853e50a2bc5d1ae4baac68ab83671ed6690697cc732`
- 价格：20美元/月
- 用途：代码审查（偶尔使用）

**成功因素**
- 根据智能体特性分配最优模型
- 达到成本最优和性能平衡
- 建立清晰的套餐使用策略

---

### 成功2：本地开发服务器配置
**服务器信息**
- API Base: `http://localhost:3001`
- WebSocket Base: `ws://localhost:3002`

**端口配置**
- HTTP服务端口：3001
- WebSocket服务端口：3002
- 状态：Server已运行

**连接信息**
- WebSocket已连接：`connected: true, readyState: 1, stateDescription: '已连接'`
- 消息发送正常：能发送文本消息到WebSocket

**成功因素**
- 清晰的端口分配（HTTP和WebSocket分开）
- 正确的协议配置（ws://用于WebSocket）
- 完整的连接状态管理

---

### 成功3：AI工具集成配置
**OpenAI兼容协议配置**
- Base URL：`https://coding.dashscope.aliyuncs.com/v1`
- 支持的AI工具：Qwen Code, Claude Code, Cline, Moltbot (原Clawdbot)
- Model：`qwen3-coder-plus`或`qwen3-max-2026-01-23`

**Anthropic兼容协议配置**
- Base URL：`https://coding.dashscope.aliyuncs.com/apps/anthropic`
- 支持的AI工具：兼容OpenAI API或Anthropic API协议的工具
- API Key：使用Coding Plan套餐专属API Key
- Model：`qwen3-coder-plus`或`qwen3-max-2026-01-23`

**订阅管理**
- 自动续费：到期前自动续费，避免资源释放
- 续费周期：每月，按实时价格自动扣费
- 套餐升降级：支持Lite升级Pro，不支持Pro降级Lite

**成功因素**
- 清晰的Base URL配置（分别用于不同协议）
- 完整的错误处理和问题排查指南
- 灵活的订阅管理（自动续费、套餐升降级）

---

### 🔴 常见问题和解决方案


### 问题1：401 invalid access token or token expired
**错误信息**
- 401 invalid access token or token expired

**可能原因**
- API Key无效、过期、为空、格式错误
- 与端点环境不匹配

**解决方案**
1. 检查API Key是否为Coding Plan套餐专属Key
2. 复制完整且无空格
3. 确认订阅状态有效
4. 检查端点环境（测试/生产）

---

### 问题2：model 'xxx' is not supported
**错误信息**
- model 'xxx' is not supported

**可能原因**
- 模型名称拼写错误、大小写错误、包含空格
- 使用了不支持的模型

**解决方案**
1. 模型名称必须为：`qwen3-coder-plus`或`qwen3-max-2026-01-23`
2. 区分大小写
3. 前后无空格
4. 确认使用的模型在支持的列表中

---

### 问题3：403 invalid api-key
**错误信息**
- 403 invalid api-key

**可能原因**
- 误用了百炼通用Base URL
- Base URL路径错误

**解决方案**
1. Anthropic兼容端点：`https://coding.dashscope.aliyuncs.com/apps/anthropic`
2. OpenAI兼容端点：`https://coding.dashscope.aliyuncs.com/v1`
3. 检查Base URL域名拼写
4. 确认使用的端点与API Key类型匹配

---

### 问题4：404 status code (no body)
**错误信息**
- 404 status code (no body)

**可能原因**
- Base URL路径错误
- 例如：在Claude Code中错误地将Base URL配置为`https://coding.dashscope.aliyuncs.com/v1`

**解决方案**
1. Claude Code正确配置：`https://coding.dashscope.aliyuncs.com/apps/anthropic`
2. 检查Base URL格式
3. 参考官方文档的端点配置

---

### 问题5：Connection error
**错误信息**
- Connection error

**可能原因**
- Base URL拼写错误或网络问题
- DNS解析失败

**解决方案**
1. 检查Base URL域名拼写
2. 检查网络连接
3. 验证端点可访问性
4. 查看详细的错误日志

---

### 问题6：hour allocated quota exceeded
**错误信息**
- hour allocated quota exceeded

**说明**
- 每5小时请求额度已用完

**解决方案**
1. 等待5小时后额度自动恢复
2. 升级至Pro套餐获得更多额度
3. 优化请求频率，避免频繁调用

---

### 问题7：week allocated quota exceeded
**错误信息**
- week allocated quota exceeded

**说明**
- 每周请求额度已用完

**解决方案**
1. 等待至每周一00:00:00（UTC+8）额度重置
2. 升级至Pro套餐获得更多额度
3. 查看使用统计，优化请求策略

---

### 问题8：month allocated quota exceeded
**错误信息**
- month allocated quota exceeded

**说明**
- 每月请求额度已用完

**解决方案**
1. 等待至订阅月对应日00:00:00（UTC+8）额度重置
2. 升级至Pro套餐获得更多额度
3. 查看套餐额度，合理分配使用

---

### 💡 重要技能和知识


### Coding Plan配置
**API端点**
- 主套餐：`https://open.bigmodel.cn/api/coding/paas/v4`
- 副套餐：`https://coding.dashscope.aliyuncs.com/v1`
- Anthropic协议：`https://coding.dashscope.aliyuncs.com/apps/anthropic`

**模型配置**
```json
{
  "provider": {
    "zhipuai-coding-plan": {
      "options": {
        "baseURL": "https://open.bigmodel.cn/api/coding/paas/v4",
        "apiKey": "5f5ae7b36c07485d97baf63b560407d5"
      }
    },
    "dashscope": {
      "options": {
        "baseURL": "https://coding.dashscope.aliyuncs.com/v1",
        "apiKey": "sk-sp-608664d68e084f8595e19adf22c76e58"
      }
    },
    "anthropic": {
      "options": {
        "baseURL": "https://coding.dashscope.aliyuncs.com/apps/anthropic",
        "apiKey": "sk-302d672abd34ff780e30f853e50a2bc5d1ae4baac68ab83671ed6690697cc732"
      }
    }
  }
}
```

### 本地开发服务器
**WebSocket连接状态管理**
```javascript
// 连接状态
{
  connected: true,
  readyState: 1,  // 1 = OPEN
  stateDescription: '已连接'
}

// 消息发送
{
  content: '你好',
  timestamp: '2026-02-01T17:11:48.116Z',
  type: 'text'
}
```

**错误检查清单**
- Server是否在指定端口运行
- WebSocket连接状态是否正常
- 浏览器控制台是否有详细错误信息
- Base URL配置是否正确

---

### 📊 错误代码参考


### 常见错误代码
| 错误代码 | 错误信息 | 原因 | 解决方案 |
|---------|---------|------|----------|
| 401 | invalid access token or token expired | API Key无效或过期 | 检查Key格式和订阅状态 |
| 403 | invalid api-key | 使用了错误的端点 | 检查Base URL配置 |
| 404 | status code (no body) | Base URL路径错误 | 修正路径配置 |
| Connection error | 连接错误 | 拼写错误或网络问题 | 检查URL和网络 |
| hour allocated quota exceeded | 5小时额度用完 | 请求频率过高 | 等待恢复或升级 |
| week allocated quota exceeded | 每周额度用完 | 需求量大 | 升级到Pro |
| month allocated quota exceeded | 每月额度用完 | 长期需求量大 | 升级到Pro |

---

### 🎯 最佳实践


### 1. 账户管理
1. **套餐选择**
   - 根据使用量选择合适套餐
   - Lite包：轻量使用
   - Pro包：大量使用
   - Max包：主Agent、顾问、写作

2. **订阅管理**
   - 启用自动续费
   - 监控使用量
   - 及时调整套餐

3. **API Key管理**
   - 安全存储API Key
   - 定期更换密钥
   - 不在代码中硬编码

### 2. 服务器配置
1. **端口管理**
   - HTTP和WebSocket端口分开
   - 避免端口冲突
   - 清晰记录端口分配

2. **连接管理**
   - 监控连接状态
   - 实现自动重连
   - 处理连接异常

3. **日志管理**
   - 记录详细的错误信息
   - 定期清理日志文件
   - 便于问题排查

### 3. 错误处理
1. **预防性检查**
   - 验证配置格式
   - 测试连接可用性
   - 检查API Key有效性

2. **优雅降级**
   - 额度用完时提供备用方案
   - 连接失败时自动重试
   - 提供友好的错误提示

3. **监控和告警**
   - 监控API调用成功率
   - 设置额度告警
   - 及时响应问题

---

### 🔧 常用配置


### Coding Plan配置
```json
{
  "providers": {
    "zhipuai-coding-plan": {
      "options": {
        "baseURL": "https://open.bigmodel.cn/api/coding/paas/v4",
        "apiKey": "your_api_key"
      }
    },
    "dashscope": {
      "options": {
        "baseURL": "https://coding.dashscope.aliyuncs.com/v1",
        "apiKey": "your_api_key"
      }
    },
    "anthropic": {
      "options": {
        "baseURL": "https://coding.dashscope.aliyuncs.com/apps/anthropic",
        "apiKey": "your_api_key"
      }
    }
  }
}
```

### 本地开发服务器
```javascript
// WebSocket配置
const WS_BASE = 'ws://localhost:3002';
const HTTP_BASE = 'http://localhost:3001';

// 连接管理
const ws = new WebSocket(WS_BASE);

ws.onopen = () => {
  console.log('WebSocket opened');
  console.log('Connection state:', {
    connected: true,
    readyState: ws.readyState,
    stateDescription: '已连接'
  });
};

ws.onmessage = (event) => {
  console.log('Message received:', event.data);
};

// 发送消息
ws.send(JSON.stringify({
  content: '你好',
  timestamp: new Date().toISOString(),
  type: 'text'
}));
```

---

### 📝 订阅策略


### 额度管理
**Lite包**
- 5小时额度限制
- 适合：个人学习、少量使用
- 优点：成本低
- 缺点：额度限制严格

**Pro包**
- 更高的额度限制
- 适合：开发工作、团队使用
- 优点：额度充足
- 缺点：成本较高

**Max包**
- 无限制或很高限制
- 适合：企业应用、高频使用
- 优点：使用灵活
- 缺点：成本最高

### 升降级策略
**升级（Lite→Pro）**
- 支持实时升级
- 费用按剩余天数折算差价
- 升级后增加可用额度

**降级限制**
- 不支持Pro→Lite降级
- 如需Lite，等待Pro到期
- 重新购买Lite套餐

---

### 📚 参考资源


### 官方文档
- Coding Plan文档：https://docs.bigmodel.cn/cn/coding-plan/overview
- 阿里百炼文档：https://help.aliyun.com/zh/model-developer/

### 相关文档
- `/home/admin/clawdbot-experience-summary/04_OpenCode操作控制经验.md`
- `/home/admin/clawdbot-experience-summary/07_重点提醒.md`

---

*文档创建时间：2026-02-15*
*基于Desktop和clawd配置文件整理完成*